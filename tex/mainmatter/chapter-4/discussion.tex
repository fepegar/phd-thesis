\section{Discussion}
\label{sec:resections_discussion}

We addressed the challenge of segmenting postoperative brain \acp{RC} from \ac{T1w} \ac{MRI} without annotated data.
We developed a self-supervised learning strategy to train without manually annotated data, and a method to simulate \acp{RC} from preoperative \ac{MRI} to generate training data.
Our novel approach is conceptually simple, easy to implement, and relies on clinical knowledge about postoperative phenomena.
The resection simulation is computationally efficient ($< \SI{1}{\second}$), so it can run during training as part of a data augmentation pipeline.
It is compatible with the TorchIO framework \cite{perez-garcia_torchio_2021} (\cref{chap:torchio}) to leverage other data argumentation techniques during training, enabling our model to have a robust performance across \ac{MRI} of variable quality.

Modeling a realistic cavity shape is important (\cref{sec:self}).
Our model generalizes well to clinical data from different institutions and pathologies, including epilepsy and glioma.
Models may be easily fine-tuned using small annotated clinical datasets to improve performance.
Moreover, our resection simulation and learning strategy may be extended to train with arbitrary modalities, or synthetic modalities generated from brain parcellations \cite{billot_learning_2020}.
Therefore, our strategy can be adopted by institutions with a large amount of unlabeled data, while fine-tuning and testing on a smaller labeled dataset.

Poor segmentation performance is often due to very small cavities, where the cavity was not detected, and large brain shift or subdural edema, where regions were incorrectly segmented.
The former issue may be overcome by training with a distribution of cavity volumes which oversamples small resections.
The latter can be addressed by extending our method to simulate displacement with biomechanical models or nonlinear deformations of the brain \cite{granados_generative_2021}.

The baseline model performance improved by leveraging unlabeled postoperative images for semi-supervised learning, but remained lower than inter-rater variability \cite{perez-garcia_simulation_2020}.  % TODO: add this info in this thesis!
We believe that a setting with a smaller training dataset might benefit further from the semi-supervised approach.
However, we did not perform an extensive assessment of our semi-supervised approach as this is out of the scope of this paper.

We showed that our model correctly segmented an intraoperative image, respecting imaginary boundaries between brain and skull, suggesting a good inductive bias of human neuroanatomy.
Qualitative results and execution time, which is in the order of milliseconds, suggest that our method could be used intraoperatively, for image guidance during resection or to improve registration with preoperative images by masking the cost function using the \ac{RC} segmentation \cite{brett_spatial_2001}.
Segmenting the \ac{RC} may also be used to study potential damage to white matter tracts postoperatively \cite{winston_optic_2012}.
Our method could be easily adapted to simulate other lesions for self-supervised training, such as cerebral microbleeds \cite{cuadrado-godia_cerebral_2018}, narrow and snake-shaped \acp{RC} typical of disconnective surgeries \cite{mohamed_temporoparietooccipital_2011}, or \acp{RC} with residual tumor \cite{meier_automatic_2017}.

Our segmentation tool for \acp{RC}, Resseg, is available online%
\fnurl{https://github.com/fepegar/resseg}
and can be easily installed using \ac{PIP}.
A 3D Slicer module is also available, so that segmentations may be performed using a \ac{GUI}, without any coding%
\fnurl{https://github.com/fepegar/SlicerParcellation\#brain-resection-cavity-segmentation}.
These tools can help clinical practice by allowing qualitative and quantitative analysis of resective surgeries.
For example, the preoperative resection plan and the \ac{RC} could be compared by overlaying them on the preoperative \ac{MRI} space \cite{nowell_utility_2015,nowell_resection_2017}.
In the context of neuro-oncology, our tools could be used for longitudinal studies of tumor recurrence \cite{meier_automatic_2017} and, adapting the simulation framework, for tumor segmentation \cite{zhang_self-supervised_2021}.

Our tools could also be used to assist research groups that study the relation between the extent of resected tissue and clinical outcomes \cite{taylor_impact_2018,galovic_association_2019} by automatically segmenting large datasets of postoperative images.

As part of this work, we curated and released EPISURG \cite{perez-garcia_episurg_2020}, an \ac{MRI} dataset with annotations from three independent raters.
EPISURG could serve as a benchmark dataset for quantitative analysis of pre- and postoperative imaging of open resection for epilepsy treatment.
A 3D Slicer module to download and browse the dataset is available on GitHub%
\fnurl{https://github.com/fepegar/SlicerEPISURG}.
To the best of our knowledge, this is the first open annotated database of post-resection \ac{MRI} for epilepsy patients.
